# è®ºæ–‡åˆ†æç³»ç»Ÿä¼˜åŒ–å¾…åŠæ¸…å•

## ğŸ“‹ ä¼˜åŒ–ç›®æ ‡
æå‡è®ºæ–‡åˆ†æçš„ç¨³å®šæ€§ã€è´¨é‡å’Œä¸€è‡´æ€§ï¼ŒåŒæ—¶ä¿æŒæˆæœ¬ä¸å˜ã€‚

## ğŸ¯ å¾…åŠäº‹é¡¹

### ä¼˜å…ˆçº§1ï¼šç«‹å³ä¼˜åŒ–

#### 1. ç®€åŒ–ç³»ç»Ÿæç¤ºè¯ â­â­â­
**å½“å‰é—®é¢˜**ï¼š
- æç¤ºè¯173è¡Œï¼Œå¤§é‡é‡å¤
- åŒä¸€æ¦‚å¿µé‡å¤å¼ºè°ƒ3-4æ¬¡
- æ¶ˆè€—è¿‡å¤štokensï¼ˆ~1500 tokensï¼‰

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
- ç¼©å‡è‡³30è¡Œå·¦å³
- ä¿ç•™æ ¸å¿ƒè¯„åˆ†æ ‡å‡†å’Œå…­ç»´åº¦æ¡†æ¶
- ç§»é™¤é‡å¤å†…å®¹
- èŠ‚çœ~1000 tokens

**æ–‡ä»¶ä½ç½®**ï¼š`src/ai/prompts.py::_get_comprehensive_system_prompt()`

---

#### 2. ç»Ÿä¸€è¯­è¨€ç­–ç•¥ â­â­â­
**å½“å‰é—®é¢˜**ï¼š
- ç³»ç»Ÿæç¤ºè¯ï¼šä¸­æ–‡
- Stage 1æ’åï¼šè‹±æ–‡
- APIè¿”å›ï¼šä¸­æ–‡
- ä¸ä¸€è‡´å¯èƒ½å½±å“æ•ˆæœ

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
- ç»Ÿä¸€ä¸ºå…¨ä¸­æ–‡ï¼ˆæ¨èï¼‰
- æ›´ç¬¦åˆä¸­æ–‡ç”¨æˆ·éœ€æ±‚
- æå‡ä¸€è‡´æ€§

**æ–‡ä»¶ä½ç½®**ï¼š
- `src/ai/prompts.py::get_stage1_ranking_system_prompt()`
- `src/ai/prompts.py::format_stage1_ranking_prompt()`

---

### ä¼˜å…ˆçº§2ï¼šé‡è¦ä¼˜åŒ–

#### 3. æ”¹ä¸ºé€ç¯‡å¹¶è¡Œåˆ†æ â­â­â­
**å½“å‰é—®é¢˜**ï¼š
- Stage 2ä¸€æ¬¡APIè°ƒç”¨åˆ†æ20ç¯‡è®ºæ–‡
- å®¹æ˜“è¶…å‡ºtokené™åˆ¶ï¼ˆ200Kï¼‰
- è§£æå¤æ‚ï¼Œå®¹æ˜“å¤±è´¥
- éƒ¨åˆ†å¤±è´¥å½±å“å…¨éƒ¨

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```python
# å½“å‰ï¼šæ‰¹é‡åˆ†æ
batch_analysis_text = self.analyzer.analyze_papers_batch(papers)

# æ”¹ä¸ºï¼šé€ç¯‡å¹¶è¡Œ
with ThreadPoolExecutor(max_workers=5) as executor:
    futures = {
        executor.submit(self.analyzer.analyze_paper, paper): paper
        for paper in papers
    }
    for future in as_completed(futures):
        result = future.result()
```

**ä¼˜åŠ¿**ï¼š
- âœ… æˆæœ¬ç›¸åŒï¼ˆæ€»tokenæ•°ä¸å˜ï¼‰
- âœ… ç¨³å®šæ€§æå‡ï¼ˆä¸ä¼šè¶…é™ï¼‰
- âœ… è´¨é‡æå‡ï¼ˆæ¯ç¯‡ä¸“æ³¨åˆ†æï¼‰
- âœ… è§£æç®€å•ï¼ˆ1å¯¹1æ˜ å°„ï¼‰
- âœ… å®¹é”™æ€§å¥½ï¼ˆå•ä¸ªå¤±è´¥ä¸å½±å“å…¶ä»–ï¼‰
- âœ… å®Œç¾å¹¶è¡Œ

**æ–‡ä»¶ä½ç½®**ï¼š`src/ai/batch_coordinator.py::_run_stage2_deep_analysis()`

---

#### 4. å®ç°æ™ºèƒ½ç« èŠ‚æå– â­â­
**å½“å‰é—®é¢˜**ï¼š
- ç®€å•æˆªå–å‰7500 tokens
- å¯èƒ½é”™è¿‡é‡è¦çš„å®éªŒå’Œç»“è®ºéƒ¨åˆ†

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```python
def smart_extract_sections(full_text, max_tokens=7500):
    """
    æ™ºèƒ½æå–å…³é”®ç« èŠ‚ï¼š
    - Abstract: 10%
    - Method/Approach: 40%
    - Experiment/Results: 35%
    - Conclusion: 15%
    """
    sections = {
        'abstract': extract_by_headers(['abstract', 'introduction']),
        'method': extract_by_headers(['method', 'approach', 'model']),
        'experiment': extract_by_headers(['experiment', 'result', 'evaluation']),
        'conclusion': extract_by_headers(['conclusion', 'discussion'])
    }
    return combine_sections(sections, max_tokens)
```

**æ–‡ä»¶ä½ç½®**ï¼š`src/ai/prompts.py::format_batch_analysis_prompt()`

---

#### 5. ä¼˜åŒ–Stage 1åŠ¨æ€æ’å â­
**å½“å‰é—®é¢˜**ï¼š
- å›ºå®šå¼ºåˆ¶åˆ†å¸ƒï¼ˆTop 10%, Next 20%, 40%, 30%ï¼‰
- å°æ‰¹æ¬¡ï¼ˆ<10ç¯‡ï¼‰åº”ç”¨å›°éš¾

**ä¼˜åŒ–æ–¹æ¡ˆ**ï¼š
```python
def get_dynamic_distribution(batch_size):
    if batch_size < 5:
        return "ç›¸å¯¹æ’åï¼Œä¸å¼ºåˆ¶åˆ†å¸ƒ"
    elif batch_size < 10:
        return "é€‚åº¦åˆ†å¸ƒï¼šä¼˜ç§€20%, è‰¯å¥½40%, ä¸€èˆ¬40%"
    else:
        return "ä¸¥æ ¼åˆ†å¸ƒï¼šä¼˜ç§€10%, è‰¯å¥½20%, ä¸­ç­‰40%, è¾ƒå·®30%"
```

**æ–‡ä»¶ä½ç½®**ï¼š`src/ai/prompts.py::get_stage1_ranking_system_prompt()`

---

### ä¼˜å…ˆçº§3ï¼šå¯é€‰ä¼˜åŒ–

#### 6. å¢åŠ è®ºæ–‡è´¨é‡é¢„æ£€
- æ£€æŸ¥æ˜¯å¦ä¸ºé¢„å°æœ¬
- æ£€æŸ¥å®éªŒå®Œæ•´æ€§
- æ ‡æ³¨å¯ä¿¡åº¦æŒ‡æ ‡

#### 7. è¯„åˆ†æ ¡å‡†æœºåˆ¶
- å®šæœŸå›é¡¾å†å²è¯„åˆ†
- è°ƒæ•´è¯„åˆ†åŸºå‡†çº¿
- ç¡®ä¿åˆ†å¸ƒåˆç†

---

## ğŸ“Š å½“å‰ç³»ç»Ÿè¯„ä¼°

### âœ… ä¼˜ç‚¹ï¼ˆä¿ç•™ï¼‰
1. ä¸¥æ ¼çš„è¯„åˆ†æ ‡å‡†ï¼ˆé¿å…è™šé«˜ï¼‰
2. å®Œæ•´çš„PDFå…¨æ–‡æå–
3. å…­ç»´åº¦ç»“æ„åŒ–åˆ†æ
4. ä¸¤é˜¶æ®µç­›é€‰æµç¨‹

### âš ï¸ é—®é¢˜ï¼ˆéœ€ä¼˜åŒ–ï¼‰
1. æç¤ºè¯å†—é•¿é‡å¤
2. ä¸­è‹±æ–‡æ··ç”¨
3. æ‰¹é‡åˆ†æä¸ç¨³å®š
4. ç®€å•æˆªå–å…¨æ–‡

---

## ğŸ’° æˆæœ¬åˆ†æ

**å…³é”®å‘ç°**ï¼šæ‰¹é‡åˆ†æ vs é€ç¯‡åˆ†ææˆæœ¬ç›¸åŒï¼

å‡è®¾æ¯å¤©åˆ†æ20ç¯‡è®ºæ–‡ï¼š

| æ–¹æ¡ˆ | APIè°ƒç”¨ | è¾“å…¥Tokens | è¾“å‡ºTokens | æˆæœ¬/æœˆ |
|------|---------|-----------|-----------|---------|
| æ‰¹é‡ | 1æ¬¡ | 200K | 20K | Â¥390 |
| é€ç¯‡ | 20æ¬¡ | 200K | 20K | Â¥390 |

**ç»“è®º**ï¼šé€ç¯‡åˆ†ææ›´ç¨³å®šï¼Œè´¨é‡æ›´é«˜ï¼Œæˆæœ¬ä¸å˜ï¼

---

## ğŸš€ å®æ–½é¡ºåº

1. âœ… ç®€åŒ–æç¤ºè¯ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
2. âœ… ç»Ÿä¸€ä¸ºå…¨ä¸­æ–‡
3. âœ… æ”¹ä¸ºé€ç¯‡å¹¶è¡Œåˆ†æ
4. âœ… å®ç°æ™ºèƒ½ç« èŠ‚æå–
5. âœ… ä¼˜åŒ–Stage 1æ’å
6. âœ… å®Œæ•´æµ‹è¯•
7. âœ… æäº¤æ¨é€

---

## ğŸ“ æµ‹è¯•è®¡åˆ’

### æµ‹è¯•ç”¨ä¾‹
1. å•ç¯‡è®ºæ–‡åˆ†æ
2. 10ç¯‡è®ºæ–‡æ‰¹é‡å¤„ç†
3. 20ç¯‡è®ºæ–‡å®Œæ•´æµç¨‹
4. è¶…é•¿è®ºæ–‡ï¼ˆ>100é¡µï¼‰
5. å¤šè¯­è¨€è®ºæ–‡ï¼ˆè‹±æ–‡/ä¸­æ–‡ï¼‰

### éªŒè¯æŒ‡æ ‡
- âœ“ æ‰€æœ‰è®ºæ–‡æˆåŠŸåˆ†æ
- âœ“ è¯„åˆ†åˆ†å¸ƒåˆç†ï¼ˆ2-3æ˜Ÿå 70%ï¼‰
- âœ“ æ— tokenè¶…é™é”™è¯¯
- âœ“ è§£ææˆåŠŸç‡100%
- âœ“ å…­ç»´åº¦è¾“å‡ºå®Œæ•´

---

## ğŸ“… å®Œæˆæ—¶é—´ä¼°ç®—
- ç®€åŒ–æç¤ºè¯ï¼š30åˆ†é’Ÿ
- ç»Ÿä¸€ä¸­æ–‡ï¼š20åˆ†é’Ÿ
- é€ç¯‡åˆ†æï¼š1å°æ—¶
- æ™ºèƒ½æå–ï¼š1.5å°æ—¶
- æµ‹è¯•éªŒè¯ï¼š1å°æ—¶
- **æ€»è®¡ï¼šçº¦4å°æ—¶**

---

## ğŸ¯ é¢„æœŸæ”¶ç›Š
1. **ç¨³å®šæ€§**ï¼šä»60%æå‡åˆ°95%
2. **è´¨é‡**ï¼šåˆ†ææ·±åº¦æå‡30%
3. **å¯ç»´æŠ¤æ€§**ï¼šä»£ç ç®€åŒ–40%
4. **ç”¨æˆ·ä½“éªŒ**ï¼šé‚®ä»¶å†…å®¹æ›´å‡†ç¡®
5. **æˆæœ¬**ï¼šä¿æŒä¸å˜
