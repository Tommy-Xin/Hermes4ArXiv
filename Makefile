.PHONY: help install run clean validate-env

help: ## æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
	@echo "ðŸš€ Hermes4ArXiv - ArXivè®ºæ–‡è‡ªåŠ¨è¿½è¸ªå™¨"
	@echo "GitHub Actionsä¸“ç”¨é…ç½®"
	@echo "å¯ç”¨å‘½ä»¤:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | sort | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-20s\033[0m %s\n", $$1, $$2}'

# =============================================================================
# ðŸ“¦ ä¾èµ–ç®¡ç†
# =============================================================================

install: ## å®‰è£…ä¾èµ–
	uv sync

update-deps: ## æ›´æ–°ä¾èµ–
	uv lock --upgrade

# =============================================================================
# ðŸ”§ é…ç½®å’ŒéªŒè¯
# =============================================================================

validate-env: ## éªŒè¯çŽ¯å¢ƒå˜é‡é…ç½®
	uv run scripts/validate_env.py

configure: ## è¿è¡Œé…ç½®åŠ©æ‰‹
	uv run scripts/configure_analysis.py

# =============================================================================
# ðŸƒ ç¨‹åºè¿è¡Œï¼ˆä¸»è¦ç”¨äºŽGitHub Actionsï¼‰
# =============================================================================

run: ## è¿è¡Œè®ºæ–‡åˆ†æžï¼ˆGitHub Actionsä¸­ä½¿ç”¨ï¼‰
	cd src && uv run python main.py

# =============================================================================
# ðŸ§¹ æ¸…ç†
# =============================================================================

clean: ## æ¸…ç†ä¸´æ—¶æ–‡ä»¶
	find . -type f -name "*.pyc" -delete
	find . -type d -name "__pycache__" -delete
	find . -type d -name "*.egg-info" -exec rm -rf {} +
	rm -rf build/
	rm -rf dist/
	rm -rf .coverage
	rm -rf htmlcov/
	rm -rf .pytest_cache/
	rm -rf .mypy_cache/

clean-cache: ## æ¸…ç† uv ç¼“å­˜
	uv cache clean

# =============================================================================
# ðŸ“Š ä¿¡æ¯æŸ¥çœ‹
# =============================================================================

show-deps: ## æ˜¾ç¤ºä¾èµ–æ ‘
	uv tree

cache-info: ## æ˜¾ç¤ºç¼“å­˜ä¿¡æ¯
	@echo "ç¼“å­˜ç›®å½•:"
	uv cache dir
	@echo "ç¼“å­˜å†…å®¹:"
	ls -la $$(uv cache dir) 2>/dev/null || echo "ç¼“å­˜ç›®å½•ä¸ºç©º"